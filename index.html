<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>VietinBank 2/9 ASCII Countdown</title>
  <style>
    :root{ --blue:#0072bc; --red:#da251d; --yellow:#ffeb3b; }
    *{box-sizing:border-box}
    html,body{height:100%;-webkit-text-size-adjust:none;text-size-adjust:none}
    body{
      margin:0;height:100%;display:grid;place-items:center;background:#000;color:#eaeaea;
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
      overflow:hidden;
    }

    /* Countdown: white on black */
    #countdownWrap{
      position:fixed;inset:0;display:none;place-items:center;background:#000;z-index:20
    }
    #countdown{
      font-size:min(22vw,200px);font-weight:900;color:#fff;letter-spacing:.08em;
      text-shadow:0 0 28px rgba(255,255,255,.6),0 0 60px rgba(255,255,255,.35);
      animation:pulse 1.1s ease both
    }
    @keyframes pulse{
      0%{transform:scale(.6);filter:blur(6px);opacity:.5}
      60%{transform:scale(1.12);filter:blur(0);opacity:1}
      100%{transform:scale(1)}
    }

    /* Slides with strong FX */
    #textSlide{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;text-align:center;z-index:15;overflow:hidden
    }
    #slideBg{
      position:absolute;inset:0;background-position:center;background-size:cover;background-repeat:no-repeat;
      transform:scale(1.06);filter:brightness(.95) saturate(1.05);
    }
    #slideOverlay{
      position:absolute;inset:0;pointer-events:none;opacity:.85;mix-blend-mode:overlay;background:transparent;
    }
    #slideText{
      position:relative;margin:0 4vw;line-height:1.05;text-align:center;
      font-family:"Times New Roman", Times, serif;
      font-weight:900;
      font-size:min(14vw,84px); /* bigger */
      letter-spacing:.04em;
      animation:zoomIn 900ms cubic-bezier(.2,.75,.25,1) both, glow 1400ms ease-in-out infinite alternate;
      filter:drop-shadow(0 2px 12px rgba(0,0,0,.35));
    }
    @keyframes zoomIn{
      0%{transform:scale(.72);filter:blur(7px);opacity:.0}
      55%{transform:scale(1.06);filter:blur(0);opacity:1}
      100%{transform:scale(1)}
    }
    @keyframes glow{
      0%{text-shadow:0 0 12px rgba(255,255,255,.28)}
      100%{text-shadow:0 0 20px rgba(255,255,255,.48)}
    }

    /* ASCII canvas area */
    #asciiWrap{
      position:fixed;inset:0;display:none;place-items:center;z-index:10;overflow:hidden;
      /* cover container to center & scale child */
    }
    #out{
      white-space:pre;margin:0;padding:0;background:#000;color:#eaeaea;
      transform-origin:center center; /* we'll scale with JS to "cover" */
      will-change:transform,font-size,line-height;
    }

    video,canvas{display:none}
  </style>
</head>
<body>

  <!-- Countdown -->
  <div id="countdownWrap"><div id="countdown"></div></div>

  <!-- Slides -->
  <div id="textSlide">
    <div id="slideBg"></div>
    <div id="slideOverlay"></div>
    <h1 id="slideText"></h1>
  </div>

  <!-- ASCII (cover) -->
  <div id="asciiWrap"><pre id="out"></pre></div>

  <!-- Video source -->
  <video id="v" playsinline crossorigin="anonymous"
         src="https://res.cloudinary.com/dj5uo6y8w/video/upload/v1756374279/bac-ho-2-9_pllr7b.mp4"></video>
  <canvas id="c"></canvas>

<script>
/* ==== DOM refs ==== */
const v = document.getElementById('v');
const c = document.getElementById('c');
const ctx = c.getContext('2d', { willReadFrequently: true });
const asciiWrap = document.getElementById('asciiWrap');
const out = document.getElementById('out');
const countdownWrap = document.getElementById('countdownWrap');
const countdown = document.getElementById('countdown');
const textSlide = document.getElementById('textSlide');
const slideBg = document.getElementById('slideBg');
const slideOverlay = document.getElementById('slideOverlay');
const slideText = document.getElementById('slideText');

/* ==== ASCII config ==== */
let asciiRows = 0;
const charset = " .:-=+*#%@";
function pickChar(n){ const len=charset.length-1; const i=Math.max(0,Math.min(len,Math.round(n*len))); return charset[i]; }
function getCols(){ return window.innerWidth < 768 ? 90 : 170; } // a bit denser to help fill

function toAsciiFrame(){
  if(!v.videoWidth) return "";
  const cols = getCols();
  const charW = 6, charH = 12; // estimated glyph aspect
  const w = cols;
  const h = Math.max(1, Math.round((v.videoHeight / v.videoWidth) * w * (charW / charH)));
  asciiRows = h;

  c.width = w; c.height = h; ctx.drawImage(v, 0, 0, w, h);
  const rgba = ctx.getImageData(0,0,w,h).data, rows=[];
  for(let y=0;y<h;y++){
    let row='';
    for(let x=0;x<w;x++){
      const i=(y*w+x)*4, r=rgba[i], g=rgba[i+1], b=rgba[i+2];
      const n=(0.299*r + 0.587*g + 0.114*b)/255;
      row += pickChar(n);
    }
    rows.push(row);
  }
  return rows.join("\n");
}

/* Fit + "cover" scale so ASCII fills screen without margins */
function setAsciiSize(){
  if(asciiRows===0) return;
  const cols=getCols();
  const fsW = window.innerWidth / cols;
  const fsH = window.innerHeight / asciiRows;
  const baseFS = Math.min(fsW, fsH);            // fit
  const baseWidth = cols * baseFS;
  const baseHeight = asciiRows * baseFS;
  const scale = Math.max(window.innerWidth/baseWidth, window.innerHeight/baseHeight); // cover

  out.style.fontSize = baseFS + "px";
  out.style.lineHeight = baseFS + "px";
  out.style.transform = `scale(${scale})`;
}

/* ==== Playback ==== */
function playAscii(){
  asciiWrap.style.display='grid';
  setAsciiSize();

  function loop(){
    if(v.paused || v.ended) return;
    out.textContent = toAsciiFrame();
    requestAnimationFrame(loop);
  }

  // Try autoplay with sound; if blocked, fallback to muted and auto-unmute on first tap
  v.muted = false; v.volume = 1;
  v.play().then(()=>{ loop(); }).catch(()=>{
    v.muted = true;
    v.play().then(()=>{
      loop();
      const oneTapUnmute = () => {
        v.muted = false;
        v.play().catch(()=>{});
        document.removeEventListener('pointerdown', oneTapUnmute, {capture:true});
      };
      document.addEventListener('pointerdown', oneTapUnmute, {once:true, capture:true});
    }).catch(err=>console.error("Không thể phát video:", err));
  });
}

/* ==== Intro sequences ==== */
function runCountdown(next){
  const steps=["3","2","1"]; let i=0;
  countdownWrap.style.display='grid';
  const tick=()=>{
    if(i<steps.length){
      countdown.textContent = steps[i++];
      countdown.style.animation='none'; void countdown.offsetWidth;
      countdown.style.animation='pulse 1.1s ease both';
      setTimeout(tick, 1100);
    }else{
      countdownWrap.style.display='none';
      next && next();
    }
  };
  tick();
}

const BG_BLUE = "https://res.cloudinary.com/dj5uo6y8w/image/upload/v1756436137/3654dadd-589c-49de-8241-1748d8ef4a69_yx4mjg.webp";
const BG_FLAG = "https://res.cloudinary.com/dj5uo6y8w/image/upload/v1756436056/hinh-nen-co-viet-nam-cho-may-tinh-1_wwoocv.jpg";

function showSlides(slides, done){
  let idx=0;
  const showOne=()=>{
    if(idx>=slides.length){
      textSlide.style.display='none';
      done && done();
      return;
    }
    const s = slides[idx++];

    slideBg.style.backgroundImage = `url('${s.bgImage}')`;
    slideOverlay.style.background = s.overlay;
    slideText.textContent = s.text;
    slideText.style.color = s.color;

    slideText.style.animation='none'; void slideText.offsetHeight;
    slideText.style.animation='zoomIn 900ms cubic-bezier(.2,.75,.25,1) both, glow 1400ms ease-in-out infinite alternate';

    textSlide.style.display='flex';
    setTimeout(showOne, s.duration);
  };
  showOne();
}

/* ==== Start chain ==== */
function startAll(){
  if(screen.orientation && screen.orientation.lock){
    screen.orientation.lock('landscape').catch(()=>{});
  }
  runCountdown(()=>{
    const slides = [
      { text: "PHÒNG DỊCH VỤ KHÁCH HÀNG", bgImage: BG_BLUE, overlay: "linear-gradient(180deg, rgba(0,114,188,.55), rgba(0,114,188,.55))", color: "#ffffff", duration: 1800 },
      { text: "VIETINBANK",                 bgImage: BG_BLUE, overlay: "linear-gradient(180deg, rgba(0,114,188,.55), rgba(0,114,188,.55))", color: "#ffffff", duration: 1600 },
      { text: "CHI NHÁNH BẢO LỘC",          bgImage: BG_BLUE, overlay: "linear-gradient(180deg, rgba(0,114,188,.55), rgba(0,114,188,.55))", color: "#ffffff", duration: 2000 },
      { text: "CHÚC MỪNG",                  bgImage: BG_FLAG, overlay: "linear-gradient(180deg, rgba(218,37,29,.45), rgba(218,37,29,.45))", color: "#ff1a1a", duration: 1600 },
      { text: "ĐẠI LỄ 2/9",                 bgImage: BG_FLAG, overlay: "linear-gradient(180deg, rgba(218,37,29,.45), rgba(218,37,29,.45))", color: "#ff1a1a", duration: 2200 },
    ];

    // make red text pop
    slideText.style.textShadow = "0 0 18px rgba(255,232,107,.75), 0 0 36px rgba(255,232,107,.45), 0 2px 12px rgba(0,0,0,.45)";
    showSlides(slides, ()=> playAscii());
  });
}

/* ==== Events ==== */
v.addEventListener('loadedmetadata', setAsciiSize);
window.addEventListener('resize', setAsciiSize);
if(screen.orientation && screen.orientation.addEventListener){
  screen.orientation.addEventListener('change', ()=> setTimeout(setAsciiSize, 80));
}
document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) setAsciiSize(); });

window.addEventListener('load', startAll);
</script>
</body>
</html>
